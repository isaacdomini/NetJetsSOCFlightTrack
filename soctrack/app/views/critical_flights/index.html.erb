
<h2>Critical Flights</h2>
<div class="container-fluid">
<table id="flightsTable" class="table table-striped table-bordered table-hover">
<thead>
  <tr>
    <th></th>
    <th>Tail No.</th>
    <th>Leg ID</th>
    <th>Departure</th>
    <th>Arrival</th>
    <th>Event Types</th>
    <th>Recovery Options</th>
    <th>ETD</th>
  </tr>
</thead>
<tfoot>
  <tr>
    <th></th>
    <th>Tail No.</th>
    <th>Leg ID</th>
    <th>Departure</th>
    <th>Arrival</th>
    <th>Event Types</th>
    <th>Recovery Options</th>
    <th>ETD</th>
  </tr>
</tfoot>
</table>
<!-- Modal -->
<div class="modal fade" id="addFlightModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <form id="newFlightForm">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="createFlightModal">Create Flight</h4>
        </div>
        <div class="modal-body">
            <div class="form-group">
              <div class="input-group">
                <span class="input-group-addon">Tail No.</span>
                <input class="form-control" placeholder="Enter Tail Number here" name="tail" type="text"/>
              </div>
            </div>
            <div class="form-group">
              <div class="input-group">
                <span class="input-group-addon">Leg ID</span>
                <input class="form-control" placeholder="Enter Leg ID here" name="leg" type="text"/>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 col-xs-6 col-sm-6">
                <div class="form-group"><div class="input-group">
                  <span class="input-group-addon">Departure</span>
                  <input class="form-control" placeholder="Enter Departure Airport Code" name="source" type="text"/>
                </div></div>
              </div>
              <div class="col-md-6 col-xs-6 col-sm-6">
                <div class="form-group"><div class="input-group">
                  <span class="input-group-addon">Arrival</span>
                  <input class="form-control" placeholder="Enter Arrival Airport Code" name="destination" type="text"/>
                </div></div>
              </div>
            </div>
            <select id="eventsSelector" class="selectpicker show-tick" multiple data-live-search="true" title="Choose Events">
              <% Event.find(1).event_hash.each do |type, vals| %>
                <optgroup label="<%=type%>">
                  <% vals.each do |val| %>
                  <option><%=val%></option>
                  <%end%>
                </optgroup>
              <%end%>
            </select>
            <!-- <button type="submit" class="btn btn-primary">Submit</button> -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          <button type="submit" class="btn btn-primary">Create</button>
        </div>
      </div>
    </form>
  </div>
</div>
<script>
  $.validator.addMethod("regx", function(value, element, regexpr) {
    console.log(value);
    return regexpr.test(value);
  }, "Invalid format");
  $('#newFlightForm').validate({
      rules: {
          tail: {
            required: true,
            regx: /^N[0-9]{3}QS$/
          },
          leg: {
            required: true,
            regx: /^[0-9]{8}$/
          },
          source: {
            required: true,
            regx: /^K[A-Z]{3}$/
          },
          destination: {
            required: true,
            regx: /^K[A-Z]{3}$/
          }
      },
      highlight: function(element) {
          $(element).closest('.form-group').addClass('has-error');
      },
      unhighlight: function(element) {
          $(element).closest('.form-group').removeClass('has-error');
      },
      errorElement: 'span',
      errorClass: 'help-block',
      errorPlacement: function(error, element) {
          if(element.parent('.input-group').length) {
              error.insertAfter(element.parent());
          } else {
              error.insertAfter(element);
          }
      }
  });
  $('#eventsSelector').on('changed.bs.select', function (event, clickedIndex, newValue, oldValue) {
    // console.log(event);
    // console.log(clickedIndex);
    console.log(newValue);
    // console.log(oldValue);
  });
</script>
<br>
<%= javascript_include_tag 'critical_flight', 'data-turbolinks-track': 'reload' %>
<%= link_to 'New Critical Flight', new_critical_flight_path %>
</div>
